<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>æŠ½å¡é é¢</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      background: linear-gradient(to right, #e0eafc, #cfdef3);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding-top: 40px;
    }

    .card-container {
      perspective: 1000px;
      width: 250px;
      height: 350px;
      position: relative;
      animation: slide-up 0.6s ease-out;
      display: none; /* Initially hide the card */
    }

    .card-container.show {
      display: block; /* Show the card when the class 'show' is added */
    }

    @keyframes slide-up {
      from {
        transform: translateY(200px);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    .card-inner {
      width: 100%;
      height: 100%;
      transition: transform 1s;
      transform-style: preserve-3d;
      position: relative;
    }

    .card-inner.flip {
      transform: rotateY(180deg);
    }

    .card-face {
      position: absolute;
      width: 100%;
      height: 100%;
      backface-visibility: hidden;
      border-radius: 12px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
    }

    .card-front {
      transform: rotateY(180deg);
    }

    .card-face img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 12px;
    }

    .glow {
      animation: glow 1s ease-in-out infinite alternate;
    }

    @keyframes glow {
      from {
        box-shadow: 0 0 10px gold;
      }
      to {
        box-shadow: 0 0 25px gold;
      }
    }

    #card-result-text {
      font-size: 1.4rem;
      font-weight: bold;
      text-align: center;
    }
  </style>
</head>
<body>

  <h1 class="mb-4">ğŸ´ æ­¡è¿ï¼Œ{{ user.username }}</h1>

  <!-- ğŸ”˜ æŠ½å¡æŒ‰éˆ•ï¼šç§»åˆ°ä¸Šæ–¹ -->
 <!-- ğŸ”˜ æŠ½å¡æŒ‰éˆ• + ç™»å‡ºæŒ‰éˆ•ï¼šæ’åœ¨åŒä¸€æ’ï¼Œå·¦å³åˆ†æ•£ -->
<!-- âœ… æŠ½å¡æŒ‰éˆ•ï¼ˆå¤§ï¼‰ + ç™»å‡ºæŒ‰éˆ•ï¼ˆå°ï¼‰ï¼Œå‚ç›´æ’åˆ— -->
<div class="d-flex flex-column align-items-center mb-4" style="gap: 10px;">
  <button id="draw-btn" class="btn btn-warning btn-lg glow">æŠ½å¡ï¼</button>
  <a href="/logout" class="btn btn-outline-secondary btn-sm">ç™»å‡º</a>
</div>

  <!-- ğŸ“ æŠ½å¡çµæœ -->
  <div id="result-text" class="mb-3 text-center fw-bold fs-5"></div>

  <!-- ğŸ´ å¡ç‰‡å‹•ç•«å€ -->
  <div class="card-container">
    <div class="card-inner" id="card-inner">
      <div class="card-face card-back">
        <img src="{{ url_for('static', filename='71874e05c6cce6d6effe02a1627829e3.png') }}" alt="å¡èƒŒ">
      </div>
      <div class="card-face card-front">
        <img id="card-front-img" src="" alt="å¡é¢">
      </div>
    </div>
  </div>




  <!-- JavaScript æ”¾åœ¨é€™è£¡ï¼ˆä¸è®Šï¼‰ -->
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const drawBtn = document.getElementById("draw-btn");
      const resultText = document.getElementById("result-text");
      const cardFrontImg = document.getElementById("card-front-img");

      const imageMap = {
        "SSR å¡ç‰‡âœ¨": "{{ url_for('static', filename='ssr.png') }}",
        "SR å¡ç‰‡ğŸŒŸ": "{{ url_for('static', filename='sr.png') }}",
        "R å¡ç‰‡â­": "{{ url_for('static', filename='r.png') }}",
        "N å¡ç‰‡ğŸ“„": "https://truth.bahamut.com.tw/s01/201905/c8fe8874d83e26d6a4a8a343dbd05ee1.JPG"
      };

      drawBtn.addEventListener("click", () => {
        const cardContainer = document.querySelector(".card-container");
        const cardInner = document.getElementById("card-inner");

        resultText.innerText = "";

        if (cardContainer.classList.contains("show")) {
          cardInner.classList.remove("flip");
          cardContainer.classList.remove("show");

          setTimeout(() => {
            drawAndAnimate(cardContainer, cardInner);
          }, 500);
        } else {
          drawAndAnimate(cardContainer, cardInner);
        }
      });

      function drawAndAnimate(cardContainer, cardInner) {
        setTimeout(() => {
          cardContainer.classList.add("show");

          setTimeout(() => {
            fetch("/draw-card", { method: "POST" })
              .then(res => res.json())
              .then(data => {
                const imgUrl = imageMap[data.result] || imageMap["N å¡ç‰‡ğŸ“„"];
                cardFrontImg.src = imgUrl;
                cardInner.classList.add("flip");
                resultText.innerText = "ğŸ‰ ä½ æŠ½åˆ°äº†ï¼šã€Œ" + data.result + "ã€";
              })
              .catch(() => {
                resultText.innerText = "ğŸ˜¢ æŠ½å¡å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦";
              });
          }, 600);
        }, 100);
      }
    });
 </script>

</body>

</html>
